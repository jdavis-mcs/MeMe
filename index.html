<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classroom Meme Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- CSS STYLING --- */
        :root {
            --primary-color: #4a90e2; /* School Friendly Blue */
            --card-bg: #ffffff;
            --bg-color: #f0f2f5;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.2rem;
            cursor: pointer;
            border-radius: 5px;
            transition: 0.2s;
        }
        .btn:hover { background: #357abd; }

        /* Login Screen */
        #login-screen {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        input {
            width: 80%;
            padding: 10px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
        }

        /* Game Layout */
        #game-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        #info-bar {
            background: white;
            width: 100%;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        /* The Meme Image */
        #meme-display {
            width: 100%;
            max-width: 500px;
            height: 400px;
            background-color: #333;
            border-radius: 10px;
            object-fit: contain;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* The Table (Where played cards go) */
        #table-area {
            min-height: 150px;
            width: 100%;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            padding: 20px;
            background: rgba(0,0,0,0.05);
            border-radius: 10px;
            margin-bottom: 20px;
        }

        /* The Player's Hand */
        #my-hand {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            width: 100%;
        }

        /* Card Design */
        .card {
            background: var(--card-bg);
            width: 200px;
            height: 250px;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            cursor: pointer;
            transition: transform 0.2s;
            user-select: none;
            border: 2px solid transparent;
        }

        .card:hover {
            transform: translateY(-10px);
            border-color: var(--primary-color);
        }

        .card.selected {
            background-color: #d1e7dd;
            border-color: #0f5132;
        }

        /* Scoreboard (Bottom Right or Absolute) */
        #scoreboard {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: left;
            min-width: 150px;
        }
        #scoreboard h3 { margin-top: 0; }
        #scoreboard ul { padding-left: 20px; margin: 0; }

    </style>
</head>
<body>

    <div id="login-screen">
        <h1>Meme Game Class</h1>
        <p>Enter your name to join:</p>
        <input type="text" id="username" placeholder="Student Name">
        <button class="btn" onclick="joinGame()">Join Game</button>
    </div>

    <div id="game-screen" class="hidden">
        
        <div id="info-bar">
            <span id="role-indicator">Role: Waiting...</span>
            <span id="judge-name-display">Current Judge: -</span>
            <button id="next-round-btn" class="hidden btn" style="font-size: 0.8rem;">Start Next Round</button>
        </div>

        <img id="meme-display" src="" alt="Waiting for round to start..." class="hidden">
        <h2 id="status-message">Waiting for players...</h2>

        <h3>The Table</h3>
        <div id="table-area">
            </div>

        <div id="hand-container">
            <h3>Your Hand</h3>
            <div id="my-hand">
                </div>
        </div>
    </div>

    <div id="scoreboard" class="hidden">
        <h3>Scores</h3>
        <ul id="player-list"></ul>
    </div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        // --- CLIENT SIDE JAVASCRIPT ---
        
        const socket = io(); // Connect to server
        let myId = null;
        let amIJudge = false;

        // --- DOM ELEMENTS ---
        const loginScreen = document.getElementById('login-screen');
        const gameScreen = document.getElementById('game-screen');
        const usernameInput = document.getElementById('username');
        const roleIndicator = document.getElementById('role-indicator');
        const statusMsg = document.getElementById('status-message');
        const memeDisplay = document.getElementById('meme-display');
        const handDiv = document.getElementById('my-hand');
        const tableDiv = document.getElementById('table-area');
        const scoreboard = document.getElementById('scoreboard');
        const playerList = document.getElementById('player-list');
        const nextRoundBtn = document.getElementById('next-round-btn');
        const handContainer = document.getElementById('hand-container');

        // --- FUNCTIONS ---

        function joinGame() {
            const name = usernameInput.value;
            if (name) {
                socket.emit('joinGame', name);
                loginScreen.classList.add('hidden');
                gameScreen.classList.remove('hidden');
                scoreboard.classList.remove('hidden');
            }
        }

        // --- SOCKET EVENT LISTENERS ---

        // 1. Initial Connection
        socket.on('connect', () => {
            myId = socket.id;
        });

        // 2. Update Player List & Scores
        socket.on('updatePlayerList', (players) => {
            playerList.innerHTML = '';
            players.forEach(p => {
                const li = document.createElement('li');
                li.innerText = `${p.name}: ${p.score} pts`;
                playerList.appendChild(li);
            });
        });

        // 3. New Round Started
        socket.on('newRound', (data) => {
            // Reset Table
            tableDiv.innerHTML = '';
            statusMsg.innerText = "Round in progress...";
            memeDisplay.src = data.memeUrl;
            memeDisplay.classList.remove('hidden');
            
            // Check Role
            amIJudge = (data.judgeId === myId);

            if (amIJudge) {
                roleIndicator.innerText = "Role: ‚öñÔ∏è THE JUDGE";
                roleIndicator.style.color = "red";
                handContainer.classList.add('hidden'); // Judge doesn't see their hand
                statusMsg.innerText = "Waiting for students to submit cards...";
                nextRoundBtn.classList.add('hidden');
            } else {
                roleIndicator.innerText = "Role: ü§° PLAYER";
                roleIndicator.style.color = "green";
                handContainer.classList.remove('hidden');
                statusMsg.innerText = "Pick a card to match the meme!";
                nextRoundBtn.classList.add('hidden');
            }
        });

        // 4. Receive My Hand (Private)
        socket.on('yourHand', (cards) => {
            handDiv.innerHTML = ''; // Clear old hand
            cards.forEach(text => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = text;
                
                // Click event to play card
                card.onclick = () => {
                    if (!amIJudge) {
                        socket.emit('playCard', text);
                        statusMsg.innerText = "Card submitted! Waiting for others...";
                        handDiv.innerHTML = ''; // Hide hand after playing
                    }
                };
                handDiv.appendChild(card);
            });
        });

        // 5. Reveal Cards (Phase 2 of Round)
        socket.on('revealCards', (submissions) => {
            tableDiv.innerHTML = ''; // Clear placeholder
            statusMsg.innerText = amIJudge ? "Choose the winner!" : "The Judge is choosing...";
            
            submissions.forEach(sub => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerText = sub.text;

                if (amIJudge) {
                    card.classList.add('selected'); // Highlight for judge
                    // Judge clicks to pick winner
                    card.onclick = () => {
                        socket.emit('judgeChoice', sub.playerId);
                    };
                }
                tableDiv.appendChild(card);
            });
        });

        // 6. Round Winner Announced
        socket.on('roundWinner', (winnerName) => {
            statusMsg.innerHTML = `üèÜ Winner: <b>${winnerName}</b>!`;
            // Show "Next Round" button only to the old judge or everyone? 
            // Let's show it to everyone for simplicity, or just the judge.
            // Currently, logic allows anyone to click it to keep flow moving.
            nextRoundBtn.classList.remove('hidden');
            nextRoundBtn.onclick = () => socket.emit('startRound');
        });

    </script>
</body>
</html>
